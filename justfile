AICMD := "codex --apply --instructions"

fix-warnings:
    cargo clippy --fix --all --allow-dirty --allow-staged
    {{AICMD}} '你是资深 Rust 工程师。请在当前仓库中：\
    - 专门处理 Rust 编译器的 warning（包括 dead_code、unused、clippy 等）\
    - 尽量通过调整代码结构、提取函数、合理使用属性等方式消除警告\
    - 不要随便注释掉代码或用 allow(dead_code) 糊弄\
    - 不改变对外可见行为和对外 API 的语义\
    - 修改完成后自行检查，确保 cargo clippy 无警告或显著减少'
    cargo fmt --all

fix-errors:
    {{AICMD}} '你是资深 Rust 工程师。请在当前仓库中：\
    - 修复所有编译错误，使项目可以至少通过 `cargo build`\
    - 优先保持现有对外 API 设计和语义不变，如需改动对外 API，应尽量向后兼容\
    - 如果某些模块暂时无法正确实现，可以先用 todo!() 或合理的 stub，但数量要尽量少\
    - 修复过程中顺便清理明显的逻辑错误，但不要大改项目结构'

update-tests:
    {{AICMD}} '你是资深 Rust 测试工程师。请在当前仓库中：\
    - 为核心功能（关键算法、重要业务逻辑、公共 API）添加或优化单元测试 / 集成测试\
    - 测试应有针对性，覆盖核心分支和边界情况，避免大量“废话性”测试\
    - 如果某些测试在当前代码结构下已经不再有意义（比如对应的函数已删除或语义完全改变），请删除这些测试\
    - 如果函数签名或用法变化，务必同步更新对应测试，而不是简单注释掉\
    - 测试命名要清晰，能看出测试的场景和预期行为\
    - 最终目标是：`cargo test` 能通过，且测试集对项目的核心行为有较好覆盖'

update-docs:
    {{AICMD}} '你是熟悉 Rust 文档规范的工程师。请在当前仓库中：\
    - 只处理“公开”的内容：所有 pub mod、pub struct、pub enum、pub trait、pub fn\
    - 为这些公开项添加或修复文档注释（/// 开头）\
    - 注释使用中文，内容重点说明“这个模块/结构体/函数的功能和用途、输入输出含义”，而不是逐行解释代码怎么写的\
    - 不需要也不要修改已有的内部注释（//）或非公开项的注释\
    - 避免废话性注释（比如“这个函数是一个函数”这种）\
    - 保持现有文档结构（如有 doc test 等），必要时修正使其能通过编译和测试'
